{{ define "main" }}
  <main class="container mx-auto ">
    {{ partial "breadcrumbs.html" . }}
    <div
      class="flex flex-col lg:flex-row gap-4 justify-between"
      aria-label="product information"
    >
      {{ partial "products/images.html" . }}
      <section aria-label="product details" class="">
        <h2 class="text-xl font-bold mb-3">{{ .Title}}</h2>
        <p>categories i18n: {{ .Params.categories }}</p>
        {{ if .Params.parameters.show }}
        <aside>
          <p>
            Parameters i18N: 
          </p>
          {{ range .Params.parameters.list }}
            <div class="product-parameters space-y-2">
              <div class="parameter">
                <strong>{{ .attribute }}:</strong> {{ .value }}
              </div>
            </div>
          {{ end }}
        </aside>
        {{ end }}
        {{ if .Params.benefits.show }}
        <p class="">Product Benefits i18n</p>
        <aside aria-label="Product Benefits" class="">
          <ul class="list-disc list-inside space-y-2">
            {{ range .Params.benefits.list }}
              <li class="mb-2">{{ . }}</li>
            {{ end }}
          </ul>
        </aside>
        {{ end }}
      </section>
    </div>
    <div class="markdown mb-9"></div>
      <div>{{ .Content }}</div>
    </div>
    <section aria-label="similar products" class="my-10">
        <div class="flex justify-between">
          <p>i18n Similar products in category: {{ .Params.categories }}</p>
          <div>
            <button data-control-similar="left" class="scroll-button">Left</button>
            <button data-control-similar="right" class="scroll-button">Right</button>
          </div>
        </div>
        <div class="overflow-x-scroll grid-flow-col grid gap-4 py-4 remove-scroll-style" id="product-container">
          {{ $products := (where .Site.RegularPages "Type" "products") }}
          {{ $category := (where .Site.RegularPages "Params.categories" .Params.categories) }}
          {{ range $index, $pages :=  $category.ByPublishDate.Reverse }}
            <div class="border overflow-hidden rounded border-gray-600 w-[220px] inline-flex flex-col">
              <div class="group overflow-hidden relative w-full" style="padding-top: 100%;">
                 {{ if or .Params.promo .Params.newPrice }}
                    <img
                      src="{{ "static/promo.svg" | relURL }}"
                      alt="Promo"
                      class="absolute top-2 left-2 size-8 z-20 rounded-full"
                    />
                  {{ end }}
                <img
                  class="absolute inset-0 size-full object-cover group-hover:scale-110 group-hover:brightness-75 transition duration-300 ease-in-out transform"
                  src="{{ $pages.Params.image }}"
                  alt="{{ $pages.Params.title }}"
                />
               <a
                  href="{{ .RelPermalink }}"
                  class="absolute inset-0 flex items-center justify-center p-4 text-white transition-all duration-500 opacity-0 ease-in-out transform group-hover:opacity-100  overflow-hidden"
                >
              {{ $settings := index .Site.Data.settings .Lang }}
              {{ $settings.more.product }}
              </a>
              </div>
              <div class="flex-grow flex flex-col justify-between text-center my-6">
                <p class="text-sm">{{ $pages.Params.title }}</p>
                <div class="*:text-sm">
                  {{ $price := float $pages.Params.price }}
                  {{ $promo := float $pages.Params.promo }}
                  {{ $newPrice := float $pages.Params.newPrice }}

                  {{ if and $promo (gt $promo 0) }}
                    {{ $discountedPrice := mul $price (sub 1 (div $promo 100)) }}
                    <p>
                      <span class="line-through text-gray-500"
                        >{{ printf "%.0f" $price }} KGS</span
                      >
                      <span class="text-green-600 font-bold ml-2"
                        >{{ printf "%.0f" $discountedPrice }} KGS</span
                      >
                      <span class="text-green-600 "
                        >({{ printf "%.2f" $promo }}% off)</span
                      >
                    </p>
                  {{ else if and (not $promo) (gt $newPrice 0) }}
                    {{ $discount := div (sub $price $newPrice) $price | mul 100 }}
                    <p>
                      <span class="line-through text-gray-500"
                        >{{ printf "%.0f" $price }} KGS</span
                      >
                      <span class="text-green-600 font-bold ml-2"
                        >{{ printf "%.0f" $newPrice }} KGS</span
                      >
                      <span class="text-green-600 "
                        >({{ printf "%.2f" $discount }}% off)</span
                      >
                    </p>
                  {{ else }}
                    <p class="">{{ printf "%.0f" $price }} KGS</p>
                  {{ end }}
                </div>
                 <a
                  href="{{ .RelPermalink }}"
                  class="text-blue-500 underline mt-2 block"
                  >{{ $settings := index .Site.Data.settings .Lang }}
                  {{ $settings.more.product }}</a
                >
              </div>
            </div>
          {{ end }}
        </div>
      </section>

      <script>
        const productContainer = document.getElementById('product-container');
        const buttons = document.querySelectorAll('.scroll-button');

        buttons.forEach(button => {
          button.addEventListener('click', () => {
            const direction = button.getAttribute('data-control-similar');
            const scrollAmount = 220; // The width of each product item
            const scrollOptions = { behavior: 'smooth', block: 'nearest' };

            if (direction === 'left') {
              productContainer.scrollBy({ left: -scrollAmount, ...scrollOptions });
            } else if (direction === 'right') {
              productContainer.scrollBy({ left: scrollAmount, ...scrollOptions });
            }
          });
        });
      </script>
</main>
{{ end }}
