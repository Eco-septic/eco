<section
  class="relative container  overflow-hidden  pt-20 pb-28 space-y-8"
  aria-label="products categories featuring"
>
  <!-- Product Section Title & Description -->
  <h2
    id="productTitle"
    class="text-xl font-bold text-center opacity-0 -translate-y-full transition-all duration-500 ease-out"
  >
    {{ .Params.productSection.title }}
  </h2>
  <p
    id="productDescription"
    class="text-lg text-center opacity-0 -translate-y-full transition-all duration-500 ease-out"
  >
    {{ .Params.productSection.description }}
  </p>

  <!-- Category Filter Buttons -->
  <div
    aria-label="filter product categories"
    class="flex justify-center gap-2 mt-4"
  >
    <button
      data-filter="all"
      class="filter-button text-base px-4 py-2 PaginationDotsActive rounded-lg opacity-0 translate-y-10 transition-all duration-500 ease-out"
    >
      all
    </button>
    {{ range $name, $taxonomy := .Site.Taxonomies.categories }}
      <button
        data-filter="{{ lower $name }}"
        class="filter-button text-base px-4 py-2 inactive rounded-lg opacity-0 translate-y-10 transition-all duration-500 ease-out"
      >
        {{ $name }}
      </button>
    {{ end }}
  </div>

  <!-- Product List Container -->
  <div
    id="productSectionList"
    class="relative container mx-auto my-20 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"
  >
    <!-- Group products by categories -->
    {{ $products := (where .Site.RegularPages "Type" "products") }}
    {{ range $index, $pages :=  $products.ByPublishDate.Reverse }}
      <div
        class="product-item"
        data-item="{{ $pages.Params.categories | lower }}"
      >
        <div class="relative w-full" style="padding-top: 100%;">
          <!-- Aspect ratio container -->
          <img
            class="absolute inset-0 size-full object-cover"
            src="https://via.placeholder.com/100x100/FF5733/ffffff?text=product"
            alt=""
          />
        </div>
        <p
          class="product-title text-base font-semibold opacity-0 translate-y-5 transition-all duration-500 ease-out"
        >
          {{ $pages.Params.title }}
        </p>
        
        <p class="text-xsm">price</p>
      </div>
    {{ end }}
  </div>

  <!-- Pagination Navigation Container -->
  <div
    id="paginationContainer"
    class="mt-8 flex justify-center items-center gap-2 absolute bottom-10 left-1/2 -translate-x-1/2"
  >
    <button
      id="productPrevSkipBtn"
      class="px-4 py-2 inactive rounded-lg mr-2"
      aria-label="Skip Previous Pages"
    >
      <<
    </button>

    <!-- Previous Page Button -->
    <button
      id="productPrevPageBtn"
      class="px-4 py-2 inactive rounded-lg"
      aria-label="Previous Page"
    >
      <
    </button>

    <!-- Pagination Dots Container -->
    <div id="productPaginationDots" class="flex space-x-2 mx-4"></div>

    <!-- Next Page Button -->
    <button
      id="productNextPageBtn"
      class="px-4 py-2 inactive rounded-lg"
      aria-label="Next Page"
    >
      >
    </button>

    <!-- Next Skip Button -->
    <button
      id="productNextSkipBtn"
      class="px-4 py-2 inactive rounded-lg ml-2"
      aria-label="Skip Next Pages"
    >
      >>
    </button>
  </div>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const filterButtons = document.querySelectorAll(".filter-button");
      const productItems = document.querySelectorAll(".product-item");
      const paginationDotsContainer = document.getElementById(
        "productPaginationDots",
      );
      const prevPageBtn = document.getElementById("productPrevPageBtn");
      const nextPageBtn = document.getElementById("productNextPageBtn");
      const nextSkip = document.getElementById("productNextSkipBtn");
      const prevSkip = document.getElementById("productPrevSkipBtn");
      // Elements

      // Default variables
      let filteredItems = Array.from(productItems);
      let currentPage = 0;
      const itemsPerPage = 8;
      const curFilter = new Map();
      const allButton = Array.from(filterButtons).find(
        (button) => button.getAttribute("data-filter") === "all",
      );

      // Store the initial filter button corresponding to "all"
      curFilter.set("button", allButton);
      let prevPage = 0;

      // Apply Filter Function
      const applyFilter = (filter) => {
        productItems.forEach((item) => {
          item.style.display = "none";
          item.classList.remove("slide-left", "slide-right");
        });

        filteredItems = Array.from(productItems).filter((item) => {
          return item.getAttribute("data-item") === filter || filter === "all";
        });

        currentPage = 0; // Reset to first page on new filter
        updatePagination(); // Update visible items based on filtered list
      };

      // Update Pagination Function
      const updatePagination = () => {
        const totalPages = Math.ceil(filteredItems.length / itemsPerPage);
        currentPage = Math.max(0, Math.min(currentPage, totalPages - 1));

        const directionClass =
          currentPage > prevPage ? "slide-left" : "slide-right";
        prevPage = currentPage;

        filteredItems.forEach((item, index) => {
          if (
            index >= currentPage * itemsPerPage &&
            index < (currentPage + 1) * itemsPerPage
          ) {
            item.style.display = "block";
            item.classList.add(directionClass);
          } else {
            item.style.display = "none";
            item.classList.remove("slide-left", "slide-right");
          }
        });

        renderPaginationDots(totalPages);
        updateButtonStates(totalPages);
      };

      // Render Pagination Dots
      const renderPaginationDots = (totalPages) => {
        paginationDotsContainer.innerHTML = "";

        // Define how many dots to show on either side of the current page
        const dotsToShow = 1; // Number of dots to show on each side

        // Calculate the start and end page numbers
        let startPage = Math.max(0, currentPage - dotsToShow); // At least show page 0
        let endPage = Math.min(totalPages - 1, currentPage + dotsToShow); // At most show the last page

        // Adjust start and end to ensure we always show 3 dots
        if (endPage - startPage < 2) {
          if (currentPage === totalPages - 1) {
            startPage = Math.max(0, endPage - 2); // Adjust if at the last page
          } else if (currentPage === 0) {
            endPage = Math.min(totalPages - 1, startPage + 2); // Adjust if at the first page
          } else {
            // Center the dots around the current page
            startPage = Math.max(0, currentPage - 1);
            endPage = Math.min(totalPages - 1, currentPage + 1);
          }
        }

        // Create the pagination dots for the visible range
        for (let i = startPage; i <= endPage; i++) {
          const dot = document.createElement("button");
          dot.classList.add("px-2", "py-1", "inactive", "rounded-lg");
          dot.textContent = i + 1; // Display 1-based index for user

          if (i === currentPage) {
            dot.classList.remove("inactive");
            dot.classList.add("PaginationDotsActive");
            dot.disabled = true;
          } else {
            dot.disabled = false;
            dot.classList.remove("PaginationDotsActive"); // Ensure to remove active classes for non-current dots
          }

          dot.addEventListener("click", () => {
            currentPage = i;
            updatePagination();
          });

          paginationDotsContainer.appendChild(dot);
        }
      };

      // Update Navigation Button States
      const updateButtonStates = (totalPages) => {
        prevPageBtn.disabled = currentPage === 0;
        nextPageBtn.disabled = currentPage === totalPages - 1;
        prevSkip.disabled = currentPage < 3;
        nextSkip.disabled = currentPage > totalPages - 3;
      };

      // Filter Button Event Listener
      filterButtons.forEach((button) => {
        button.addEventListener("click", () => {
          if (curFilter.get("button")) {
            curFilter.get("button").classList.remove("PaginationDotsActive");
            curFilter.get("button").classList.add("inactive");
          }
          button.classList.add("PaginationDotsActive");
          button.classList.remove("inactive");
          curFilter.set("button", button);

          const filter = button.getAttribute("data-filter");
          applyFilter(filter);
        });
      });

      // Next and Previous Buttons
      prevPageBtn.addEventListener("click", () => {
        currentPage = Math.max(0, currentPage - 1);
        updatePagination();
      });

      nextPageBtn.addEventListener("click", () => {
        currentPage = Math.min(
          currentPage + 1,
          Math.ceil(filteredItems.length / itemsPerPage) - 1,
        );
        updatePagination();
      });
      // Next Skip Button (Skip 3 Pages)
      nextSkip.addEventListener("click", () => {
        currentPage = Math.min(
          currentPage + 3,
          Math.ceil(filteredItems.length / itemsPerPage) - 1,
        );
        updatePagination();
      });

      // Previous Skip Button (Skip 3 Pages)
      prevSkip.addEventListener("click", () => {
        currentPage = Math.max(0, currentPage - 3);
        updatePagination();
      });

      // Initial Setup: Show All Items
      applyFilter("all");
    });
  </script>
</section>
